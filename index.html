<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Aurora PNGTuber</title>
  <style>
    body {
      background: transparent;
      margin: 0;
      overflow: hidden;
      display: flex;
      align-items: center;
      justify-content: center;
      height: 100vh;
    }
    img {
      position: absolute;
      width: 600px;
      image-rendering: auto;
      transition: opacity 0.1s ease;
    }
  </style>
</head>
<body>
  <img id="closed" src="aurora_closed.png">
  <img id="open" src="aurora_open.png" style="opacity: 0;">

  <script>
    let audioContext = new AudioContext();
    let analyser = audioContext.createAnalyser();
    let dataArray = new Uint8Array(analyser.frequencyBinCount);

    navigator.mediaDevices.getUserMedia({ audio: true }).then(stream => {
      let source = audioContext.createMediaStreamSource(stream);
      source.connect(analyser);
      animate();
    });

    function animate() {
      requestAnimationFrame(animate);
      analyser.getByteFrequencyData(dataArray);
      let volume = dataArray.reduce((a, b) => a + b) / dataArray.length;

      // mouth open if volume > threshold
      document.getElementById("open").style.opacity = volume > 30 ? 1 : 0;
      document.getElementById("closed").style.opacity = volume > 30 ? 0 : 1;
    }
  </script>
</body>
</html>
